<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SnackPOS Pro üõ°Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #f1f5f9;
            --primary: #4f46e5;
            --whatsapp: #25d366;
            --danger: #f43f5e;
            --surface: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --radius: 18px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text-main);
            margin: 0; padding-bottom: 90px; overflow-x: hidden;
        }

        header { 
            background: var(--surface); padding: 20px; 
            border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 50;
            display: flex; justify-content: space-between; align-items: center;
        }
        header h1 { font-size: 22px; margin: 0; font-weight: 800; letter-spacing: -0.5px; }
        header p { font-size: 13px; color: var(--text-muted); margin: 0; }

        .container { padding: 16px; max-width: 600px; margin: 0 auto; }

        .search-bar {
            width: 100%; padding: 12px 16px; border-radius: 12px; border: 1px solid var(--border);
            margin-bottom: 16px; font-family: inherit; font-size: 14px;
        }

        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        
        .product-card { 
            background: var(--surface); border-radius: var(--radius); padding: 16px;
            text-align: center; border: 1px solid var(--border);
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); transition: all 0.2s;
        }
        .product-card:active { transform: scale(0.96); border-color: var(--primary); }
        .p-emoji { font-size: 38px; display: block; margin-bottom: 8px; }
        .p-name { font-size: 14px; font-weight: 700; display: block; height: 34px; line-height: 1.2; }
        .p-price { color: var(--primary); font-weight: 800; font-size: 18px; margin-top: 4px; display: block; }

        .cart-item { 
            background: white; padding: 14px; border-radius: 16px; margin-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.03);
        }
        .qty-controls { display: flex; align-items: center; gap: 12px; }
        .btn-qty { 
            width: 28px; height: 28px; border-radius: 8px; border: 1px solid var(--border);
            background: #f8fafc; font-weight: bold; cursor: pointer;
        }

        .bottom-nav { 
            position: fixed; bottom: 0; left: 0; right: 0; height: 75px;
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px);
            border-top: 1px solid var(--border); display: flex; z-index: 100;
        }
        .nav-item { 
            background: none; border: none; color: var(--text-muted); font-size: 11px;
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; flex: 1;
            font-family: inherit; font-weight: 600;
        }
        .nav-item.active { color: var(--primary); }
        .nav-item span { font-size: 22px; }

        .page { display: none; animation: slideUp 0.3s ease-out; }
        .page.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .btn { 
            width: 100%; padding: 16px; border-radius: 14px; border: none; 
            font-weight: 700; font-size: 16px; transition: 0.2s; cursor: pointer;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-wa { background: var(--whatsapp); color: white; display: flex; align-items: center; justify-content: center; gap: 8px; }

        .badge { 
            background: var(--danger); color: white; font-size: 10px; 
            min-width: 18px; height: 18px; line-height: 18px; border-radius: 50%;
            position: absolute; top: 12px; right: 25%; font-weight: 800;
        }

        .sale-card {
            background: white; border-left: 4px solid var(--primary);
            padding: 12px; border-radius: 12px; margin-bottom: 10px; font-size: 13px;
        }
    </style>
</head>
<body>

<header>
    <div>
        <h1>SnackPOS üõ°Ô∏è</h1>
        <p id="fecha-actual"></p>
    </div>
    <div style="text-align: right">
        <span id="total-ventas-dia-header" style="font-weight: 800; color: var(--primary);">$0</span>
        <div style="font-size: 10px; color: var(--text-muted);">HOY</div>
    </div>
</header>

<div class="container">
    <div id="view-menu" class="page active">
        <input type="text" class="search-bar" placeholder="Buscar snack..." oninput="filtrarProductos(this.value)">
        <div class="product-grid" id="grid-productos"></div>
    </div>

    <div id="view-cart" class="page">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 style="margin:0">Tu Orden</h3>
            <button onclick="vaciarCarrito()" style="color:var(--danger); border:none; background:none; font-weight:700;">VACIAR</button>
        </div>
        <div id="cart-list"></div>
        <div id="cart-footer" style="margin-top: 20px; display: none;">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px; padding: 10px 0; border-top: 2px dashed var(--border);">
                <span style="font-size: 18px; font-weight: 600;">Total</span>
                <span id="total-val" style="font-size: 24px; font-weight: 800; color: var(--primary);">$0.00</span>
            </div>
            <button class="btn btn-primary" onclick="checkout()">‚úÖ Finalizar Venta</button>
        </div>
    </div>

    <div id="view-reports" class="page">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
            <h3 style="margin:0;">Ventas de Hoy</h3>
            <button onclick="sacarCuentaDia()" style="background: var(--text-main); color: white; border: none; padding: 10px 15px; border-radius: 12px; font-weight: 700; font-size: 12px; cursor: pointer;">
                üí∞ SACA CUENTA DEL D√çA
            </button>
        </div>
        <div id="history-content"></div>
        <div style="margin-top: 30px; background: #fff; padding: 20px; border-radius: var(--radius); border: 1px solid var(--border);">
            <h4>WhatsApp Marketing</h4>
            <input type="tel" id="wa-number" class="search-bar" placeholder="N√∫mero de cliente">
            <button class="btn btn-wa" onclick="enviarMenuWA()">üì≤ Enviar Men√∫</button>
        </div>
    </div>
</div>

<nav class="bottom-nav">
    <button class="nav-item active" onclick="showPage('view-menu', this)"><span>üç¥</span>Men√∫</button>
    <button class="nav-item" onclick="showPage('view-cart', this)" style="position:relative;">
        <span>üõí</span>Orden
        <span id="cart-badge" class="badge" style="display:none;">0</span>
    </button>
    <button class="nav-item" onclick="showPage('view-reports', this)"><span>üìä</span>Reportes</button>
</nav>

<script>
    const CATALOGO = [
        { n: 'PAPAS FRANCESA', p: 45, e: 'üçü' },
        { n: 'PAPA HOJUELA', p: 25, e: 'ü•î' },
        { n: 'PLATANOS FRITOS', p: 45, e: 'üçå' },
        { n: 'PLATANOS CAPEADO', p: 55, e: 'üç≥' },
        { n: 'GALLETA CAPEADA', p: 55, e: 'üç™' },
        { n: 'ALITAS', p: 65, e: 'üçó' },
    ];

    let cart = JSON.parse(localStorage.getItem('snack_cart')) || [];
    let salesHistory = JSON.parse(localStorage.getItem('snack_sales_v2')) || [];

    function init() {
        renderProducts(CATALOGO);
        updateUI();
        document.getElementById('fecha-actual').innerText = new Date().toLocaleDateString('es-ES', { weekday:'short', day:'numeric', month:'short' });
    }

    function renderProducts(lista) {
        const grid = document.getElementById('grid-productos');
        grid.innerHTML = '';
        lista.forEach(p => {
            grid.innerHTML += `
                <div class="product-card" onclick="addItem('${p.n}', ${p.p}, '${p.e}')">
                    <span class="p-emoji">${p.e}</span>
                    <span class="p-name">${p.n}</span>
                    <span class="p-price">$${p.p}</span>
                </div>`;
        });
    }

    function filtrarProductos(val) {
        const filtrados = CATALOGO.filter(p => p.n.toLowerCase().includes(val.toLowerCase()));
        renderProducts(filtrados);
    }

    function addItem(n, p, e) {
        const item = cart.find(i => i.n === n);
        if (item) { item.q++; item.s = item.q * p; }
        else { cart.push({ n, p, q: 1, s: p, e }); }
        saveCart();
        updateUI();
    }

    function changeQty(name, delta) {
        const item = cart.find(i => i.n === name);
        if (item) {
            item.q += delta;
            item.s = item.q * item.p;
            if (item.q <= 0) cart = cart.filter(i => i.n !== name);
        }
        saveCart();
        updateUI();
    }

    function saveCart() { localStorage.setItem('snack_cart', JSON.stringify(cart)); }

    function updateUI() {
        const totalItems = cart.reduce((acc, i) => acc + i.q, 0);
        const b = document.getElementById('cart-badge');
        b.innerText = totalItems;
        b.style.display = totalItems > 0 ? 'block' : 'none';

        const container = document.getElementById('cart-list');
        const footer = document.getElementById('cart-footer');
        
        if (cart.length === 0) {
            container.innerHTML = '<p style="text-align:center; padding:40px; color:#94a3b8;">Tu carrito est√° vac√≠o</p>';
            footer.style.display = 'none';
        } else {
            container.innerHTML = '';
            let total = 0;
            cart.forEach(i => {
                total += i.s;
                container.innerHTML += `
                    <div class="cart-item">
                        <div><b>${i.e} ${i.n}</b><br><small>$${i.p}</small></div>
                        <div class="qty-controls">
                            <button class="btn-qty" onclick="changeQty('${i.n}', -1)">-</button>
                            <span>${i.q}</span>
                            <button class="btn-qty" onclick="changeQty('${i.n}', 1)">+</button>
                            <b style="margin-left:10px">$${i.s}</b>
                        </div>
                    </div>`;
            });
            document.getElementById('total-val').innerText = `$${total.toFixed(2)}`;
            footer.style.display = 'block';
        }

        const hoy = new Date().toLocaleDateString('es-ES');
        const ventasHoy = salesHistory.filter(s => s.f === hoy).reduce((acc, s) => acc + s.t, 0);
        document.getElementById('total-ventas-dia-header').innerText = `$${ventasHoy}`;
    }

    function showPage(id, btn) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
        if(id === 'view-reports') renderReports();
    }

    function checkout() {
        if (!cart.length) return;
        const sale = {
            t: cart.reduce((a, b) => a + b.s, 0),
            h: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
            f: new Date().toLocaleDateString('es-ES'),
            items: cart.map(i => `${i.q}x ${i.n}`).join(', ')
        };
        salesHistory.unshift(sale);
        localStorage.setItem('snack_sales_v2', JSON.stringify(salesHistory));
        cart = [];
        saveCart();
        updateUI();
        alert("‚úÖ Venta Guardada");
        showPage('view-menu', document.querySelector('.nav-item'));
    }

    function renderReports() {
        const cont = document.getElementById('history-content');
        cont.innerHTML = salesHistory.slice(0, 10).map(s => `
            <div class="sale-card">
                <div style="display:flex; justify-content:space-between">
                    <b>$${s.t}</b> <small>${s.h}</small>
                </div>
                <div style="font-size:11px; color:var(--text-muted)">${s.items}</div>
            </div>
        `).join('') || 'Sin ventas hoy.';
    }

    function sacarCuentaDia() {
        const hoy = new Date().toLocaleDateString('es-ES');
        const ventasDeHoy = salesHistory.filter(s => s.f === hoy);
        const total = ventasDeHoy.reduce((acc, s) => acc + s.t, 0);
        alert(`üìä CORTE DE CAJA (${hoy})\n\nTotal Vendido: $${total.toFixed(2)}\nPedidos: ${ventasDeHoy.length}\n\n¬°Buen cierre! üõ°Ô∏è`);
    }

    function vaciarCarrito() { if(confirm("¬øBorrar orden?")) { cart = []; saveCart(); updateUI(); } }

    function enviarMenuWA() {
        const n = document.getElementById('wa-number').value.replace(/\D/g,'');
        if(!n) return alert("Escribe un n√∫mero");
        let m = "*üçü MEN√ö SNACKS üçü*%0A%0A" + CATALOGO.map(p => `${p.e} *${p.n}* - $${p.p}`).join('%0A');
        window.open(`https://wa.me/${n}?text=${m}`, '_blank');
    }

    init();
</script>
</body>
</html>